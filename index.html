<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>For Thu Trang üíå</title>

<style>
  :root{
    --sat: env(safe-area-inset-top, 0px);
    --sab: env(safe-area-inset-bottom, 0px);
  }

  body{
    margin:0;
    height:100vh;
    font-family:system-ui;
    overflow:hidden;
    background: url("dogcat.jpg") center / cover no-repeat fixed;
  }

  body.yes-bg{
    background: url("couple.jpg") center / cover no-repeat fixed;
  }

  .overlay{
    position:fixed;
    inset:0;
    background: rgba(0,0,0,.18);
    pointer-events:none;
    z-index:1;
  }
  body.yes-bg .overlay{ background: rgba(0,0,0,.22); }

  /* stage ph·ªß ƒë√∫ng ph·∫ßn nh√¨n th·∫•y (iPhone/Zalo bar co gi√£n v·∫´n ok) */
  #stage{
    position:fixed;
    left:0; top:0;
    width:100vw;
    height:100svh;         /* ‚úÖ key fix */
    z-index:5;
    pointer-events:none;   /* ch·ªâ b·∫≠t khi ƒë∆∞a NO v√†o stage */
  }

  .center{
    position:fixed;
    left:50%;
    top:45%;
    transform:translate(-50%,-50%);
    width:min(560px,92vw);
    text-align:center;
    z-index:6;
    display:none; /* ‚úÖ ·∫©n, ch·ªâ hi·ªán sau khi nh·∫≠p ƒë√∫ng pass */
  }

  h2{
    margin:0 0 14px;
    color:#fff;
    font-weight:900;
    font-size:22px;
    text-shadow:0 10px 30px rgba(0,0,0,.45);
  }

  .btn-row{
    display:flex;
    justify-content:center;
    gap:60px;
    align-items:center;
  }

  button{
    padding:14px 28px;
    border:none;
    border-radius:999px;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    touch-action:manipulation;
    transition: transform .25s ease, left .18s ease, top .18s ease;
    margin:0;
  }

  #yes{
    background:#ff3b7b;
    color:#fff;
    transform:scale(1);
    z-index:9998;
    position:relative;
  }

  #no{
    background:#eee;
    color:#111;
    z-index:9999;
    position:relative;
  }

  .love-box{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:min(560px,92vw);
    padding:18px 18px;
    border-radius:22px;
    background:rgba(255,255,255,.82);
    backdrop-filter: blur(10px);
    box-shadow:0 18px 45px rgba(0,0,0,.22);
    text-align:center;
    z-index:10;
    display:none;
  }
  .love-box.show{ display:block; }

  .love-text{
    margin:0;
    color:#ff3b7b;
    font-weight:900;
    font-size:20px;
    line-height:1.35;
  }

  .hearts{
    position:fixed;
    inset:0;
    pointer-events:none;
    overflow:hidden;
    z-index:9;
  }
  .heart{
    position:absolute;
    bottom:-30px;
    animation: float 2.2s ease forwards;
    opacity:.95;
    filter: drop-shadow(0 10px 14px rgba(0,0,0,.18));
  }
  @keyframes float{
    0%{transform:translateY(0) scale(.8);opacity:0}
    10%{opacity:1}
    100%{transform:translateY(-420px) scale(1.55);opacity:0}
  }

  /* ===== Password Gate ===== */
  .gate{
    position:fixed;
    inset:0;
    display:grid;
    place-items:center;
    z-index:20;
  }

  .gate-card{
    width:min(460px,92vw);
    padding:18px;
    border-radius:22px;
    background:rgba(255,255,255,.88);
    backdrop-filter: blur(10px);
    box-shadow:0 18px 45px rgba(0,0,0,.22);
    text-align:center;
  }

  .gate-title{
    margin:0 0 14px;
    font-weight:900;
    color:#ff3b7b;
    font-size:20px;
  }

  .gate-row{
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    flex-wrap:wrap;
  }

  .gate-input{
    width:min(260px,70vw);
    padding:12px 14px;
    border-radius:14px;
    border:1px solid rgba(0,0,0,.12);
    font-size:16px;
    outline:none;
  }

  .gate-btn{
    padding:12px 16px;
    border-radius:14px;
    border:none;
    background:#ff3b7b;
    color:white;
    font-weight:800;
    cursor:pointer;
  }

  .gate-msg{
    margin:10px 0 0;
    font-weight:800;
    color:#d11;
    min-height:20px;
  }

  .shake{
    animation: shake .25s linear 0s 2;
  }
  @keyframes shake{
    0%{transform:translateX(0)}
    25%{transform:translateX(-8px)}
    50%{transform:translateX(8px)}
    75%{transform:translateX(-6px)}
    100%{transform:translateX(0)}
  }

  /* ===== NEW: text bay t·ª´ d∆∞·ªõi l√™n khi b·∫•m NO ===== */
  .float-text{
    position:fixed;
    left:50%;
    bottom:-40px;
    transform:translateX(-50%);
    color:#fff;
    font-weight:900;
    font-size:16px;
    text-shadow:0 6px 18px rgba(0,0,0,.45);
    animation: floatText 4.5s linear forwards;   /* ch·∫≠m h∆°n */
    z-index:9999;
    pointer-events:none;
    white-space:nowrap;
  }

  @keyframes floatText{
    0%   {opacity:0; transform:translate(-50%,0)}
    5%   {opacity:1}
    90%  {opacity:1}
    100% {opacity:0; transform:translate(-50%,-100vh)}  /* bay l√™n t·ªõi m√©p tr√™n */
  }
</style>
</head>

<body>
  <div class="overlay"></div>
  <div class="hearts" id="hearts"></div>
  <div id="stage"></div>

  <!-- Password Gate -->
  <div class="gate" id="gate">
    <div class="gate-card" id="gateCard">
      <p class="gate-title">Ng√†y anni c·ªßa t·ª•i m√¨nh n√® </p>
      <div class="gate-row">
        <!-- ‚úÖ B√†n ph√≠m s·ªë iPhone: inputmode + pattern + maxlength -->
        <input
          id="pw"
          class="gate-input"
          type="password"
          placeholder="ddmmyy"
          inputmode="numeric"
          pattern="[0-9]*"
          maxlength="8"
          autocomplete="off"
        />
        <button id="unlock" class="gate-btn">M·ªü thi·ªáp</button>
      </div>
      <p class="gate-msg" id="gateMsg"></p>
    </div>
  </div>

  <div class="love-box" id="loveBox">
    <p class="love-text">C·∫£m ∆°n em iuuu üíñ, ba y√™u Thu Trang nhi·ªÅu l·∫Ømmm ü¶¶ Mong c·ª•c d√†ng thi·ªát vui v√† ·∫•m √°p nhe xoxoxoxo </p>
  </div>

  <div class="center" id="centerUI">
    <h2>Thu Trang ∆°i, will you be my valentine? üíåü´ß</h2>
    <div class="btn-row">
      <button id="yes">Yes</button>
      <button id="no">No</button>
    </div>
  </div>

<script>
  /* ===== PASSWORD ===== */
  const PASSWORD = "05072025";
  const gate = document.getElementById("gate");
  const gateCard = document.getElementById("gateCard");
  const pw = document.getElementById("pw");
  const unlock = document.getElementById("unlock");
  const gateMsg = document.getElementById("gateMsg");

  function doUnlock(){
    const val = (pw.value || "").trim();
    if (val === PASSWORD){
      gate.style.display = "none";
      document.getElementById("centerUI").style.display = "block";
      gateMsg.textContent = "";
      pw.value = "";
      pw.blur(); // ‚úÖ ƒë√≥ng b√†n ph√≠m ƒë·ªÉ l·∫ßn b·∫•m NO ƒë·∫ßu ti√™n kh√¥ng b·ªã "ƒÉn"
    } else {
      gateMsg.textContent = "Sai r·ªìi üòù";
      gateCard.classList.remove("shake");
      void gateCard.offsetWidth;
      gateCard.classList.add("shake");
    }
  }

  unlock.addEventListener("click", doUnlock);
  pw.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doUnlock(); });

  /* ===== NEW: 15 c√¢u + random m·ªói l·∫ßn v√†o link ===== */
  const noMessages = [
    "·ª¶a thi·ªát lu√¥n h·∫£ ü•≤",
    "Ch·ªçn l·∫°i ƒëi m√†aa",
    "Anh nghƒ© em b·∫•m nh·∫ßm ƒë√≥ üòÜ",
    "No kh√¥ng h·ª£p l·ªá nha",
    "Suy nghƒ© th√™m 1 gi√¢y n·ªØa ƒëi",
    "Th·ª≠ b·∫•m Yes xem sao",
    "Kh√¥ng tho√°t ƒë∆∞·ª£c ƒë√¢u üòè",
    "Anh ƒëang ƒë·ª£i c√¢u Yes ƒë√≥",
    "N√£y gi·ªù anh th·∫•y c·ª•c d√†ng ph√¢n v√¢n",
    "Ch·∫Øc ch·∫Øn ch∆∞a ƒë√≥oo",
    "C∆° h·ªôi cu·ªëi n√® üòù",
    "Ba tin Thu Trang s·∫Ω ch·ªçn Yes m√†",
    "ƒê·ª´ng l√†m tr√°i tim anh ƒëau ü•∫",
    "Em iu th·ª≠ l·∫°i l·∫ßn n·ªØa ƒëi",
    "Yes m·ªõi l√† ƒë√°p √°n ƒë√∫ng"
  ];

  noMessages.sort(() => Math.random() - 0.5);
  let msgIndex = 0;

  function showNoMessage(){
    // ‚úÖ kh√¥ng cho ch·ªìng ch·ªØ: x√≥a c√°i ƒëang ch·∫°y (n·∫øu c√≥) r·ªìi m·ªõi t·∫°o c√°i m·ªõi
    document.querySelectorAll(".float-text").forEach(x => x.remove());

    const el = document.createElement("div");
    el.className = "float-text";
    el.textContent = noMessages[msgIndex % noMessages.length];
    msgIndex++;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 4500);
  }

  /* ===== ORIGINAL EFFECTS (unchanged) ===== */
  const yesBtn   = document.getElementById("yes");
  const noBtn    = document.getElementById("no");
  const hearts   = document.getElementById("hearts");
  const loveBox  = document.getElementById("loveBox");
  const centerUI = document.getElementById("centerUI");
  const stage    = document.getElementById("stage");

  let noCount = 0;
  let finalScale = null;
  let noIsFloating = false;
  let heartTimer = null;

  // ‚úÖ ch·∫∑n double-trigger (touchstart + click) g√¢y nh·∫£y 2 l·∫ßn + ch·ªìng ch·ªØ
  let lastNoTap = 0;

  function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  function stageSize(){ return { w: stage.clientWidth, h: stage.clientHeight }; }

  function computeFinalScale(){
    const r = yesBtn.getBoundingClientRect();
    const targetW = stageSize().w * 0.92;
    return clamp(targetW / r.width, 1, 12);
  }

  function intersects(a, b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }

  function getAvoidRects(){
    return {
      centerRect: centerUI.getBoundingClientRect(),
      yesRect: yesBtn.getBoundingClientRect()
    };
  }

  function pickNoPositionAvoiding(){
    const { w, h } = stageSize();
    const b = noBtn.getBoundingClientRect();

    const padSide = 14;

    // ‚úÖ ƒë·ªçc safe-area iPhone (notch + home bar)
    const safeTop = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--sat")) || 0;
    const safeBottom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--sab")) || 0;

    const padTop = 90 + safeTop;          // ch·ª´a ph·∫ßn tr√™n nhi·ªÅu h∆°n
    const padBottom = 120 + safeBottom;   // ch·ª´a ph·∫ßn d∆∞·ªõi nhi·ªÅu h∆°n ƒë·ªÉ kh√¥ng d√≠nh home bar

    const minX = padSide;
    const maxX = Math.max(minX, w - b.width - padSide);

    const { centerRect, yesRect } = getAvoidRects();

    // chia 2 v√πng Y: upper / lower (gi·ªØ ƒë√∫ng 60/40)
    const upperMinY = padTop;
    const upperMaxY = Math.max(upperMinY, Math.floor(h * 0.48) - b.height);

    const lowerMinY = Math.max(padTop, Math.floor(h * 0.55));
    const lowerMaxY = Math.max(lowerMinY, h - b.height - padBottom);

    function tryPick(yMin, yMax){
      for(let i=0;i<80;i++){
        const x = rand(minX, maxX);
        const y = rand(yMin, yMax);

        const candidate = { left:x, top:y, right:x+b.width, bottom:y+b.height };
        if (intersects(candidate, centerRect)) continue;
        if (intersects(candidate, yesRect)) continue;

        return { x, y };
      }
      return null;
    }

    const useUpper = Math.random() < 0.6;

    let pos = null;
    if (useUpper){
      pos = tryPick(upperMinY, upperMaxY) || tryPick(lowerMinY, lowerMaxY);
    } else {
      pos = tryPick(lowerMinY, lowerMaxY) || tryPick(upperMinY, upperMaxY);
    }

    return pos || { x: Math.floor(w*0.30), y: Math.floor(h*0.70) };
  }

  function moveNo(){
    const pos = pickNoPositionAvoiding();
    noBtn.style.left = pos.x + "px";
    noBtn.style.top  = pos.y + "px";
  }

  function spawnHeart(){
    const icons = ["üíó","üíñ","‚ù§Ô∏è","ü´ß"];
    const w = stageSize().w;
    const el = document.createElement("div");
    el.className = "heart";
    el.textContent = icons[rand(0, icons.length-1)];
    el.style.left = rand(0, w) + "px";
    el.style.fontSize = rand(18, 36) + "px";
    el.style.animationDuration = (1.8 + Math.random()*1.1).toFixed(2) + "s";
    hearts.appendChild(el);
    el.addEventListener("animationend", ()=> el.remove());
  }

  function startHeartsForever(){
    if (heartTimer) return;
    heartTimer = setInterval(() => {
      spawnHeart();
      if (Math.random() > 0.45) spawnHeart();
    }, 180);
  }

  function handleNo(e){
    e.preventDefault();

    const now = Date.now();
    if (now - lastNoTap < 350) return; // ‚úÖ ch·∫∑n double-trigger
    lastNoTap = now;

    showNoMessage();

    if (!noIsFloating){
      noIsFloating = true;

      stage.style.pointerEvents = "auto";
      stage.appendChild(noBtn);

      noBtn.style.position = "absolute";
      noBtn.style.transform = "none";

      // ƒë·∫∑t ngay g·∫ßn d∆∞·ªõi c√¢u h·ªèi tr∆∞·ªõc
      noBtn.style.left = "50%";
      noBtn.style.top  = "68%";
      noBtn.style.transform = "translate(-50%,-50%)";

      setTimeout(() => {
        noBtn.style.transform = "none";
        moveNo();
      }, 50);
    } else {
      moveNo();
    }

    // YES to d·∫ßn ~15 l·∫ßn
    noCount++;
    if (!finalScale) finalScale = computeFinalScale();
    const t = Math.min(noCount / 15, 1);
    const scale = 1 + t * (finalScale - 1);

    if (t > 0.55){
      setTimeout(()=>{
        yesBtn.style.position = "fixed";
        yesBtn.style.left = "50%";
        yesBtn.style.top  = "62%";
        yesBtn.style.transform = `translate(-50%,-50%) scale(${scale})`;
      }, 280);
    } else {
      yesBtn.style.transform = `scale(${scale})`;
    }

    if (t === 1){
      yesBtn.style.position = "fixed";
      yesBtn.style.left = "50%";
      yesBtn.style.top  = "62%";
      yesBtn.style.transform = `translate(-50%,-50%) scale(${finalScale})`;
    }
  }

  // ‚úÖ gi·ªØ pointerdown + th√™m touchstart/click ƒë·ªÉ iPhone lu√¥n ƒÉn
  noBtn.addEventListener("pointerdown", handleNo);
  noBtn.addEventListener("touchstart", handleNo, { passive:false });
  noBtn.addEventListener("click", handleNo);

  yesBtn.addEventListener("click", ()=>{
    document.body.classList.add("yes-bg");
    loveBox.classList.add("show");

    centerUI.style.display = "none";
    noBtn.style.display = "none";
    yesBtn.style.display = "none";

    startHeartsForever();
  });

  window.addEventListener("resize", ()=>{
    finalScale = null;
    if (noIsFloating) moveNo();
  });
</script>
</body>
</html>
