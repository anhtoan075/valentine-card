<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>For Thu Trang üíå</title>

<style>
  body{
    margin:0;
    height:100vh;
    font-family:system-ui;
    overflow:hidden;
    background: url("dogcat.jpg") center / cover no-repeat fixed;
    position:relative;
  }
  body.yes-bg{
    background: url("couple.jpg") center / cover no-repeat fixed;
  }

  .overlay{
    position:fixed; inset:0;
    background: linear-gradient(rgba(0,0,0,.18), rgba(0,0,0,.18));
    pointer-events:none;
  }
  body.yes-bg .overlay{
    background: linear-gradient(rgba(0,0,0,.22), rgba(0,0,0,.22));
  }

  .center{
    position:fixed;
    left:50%;
    top:45%;
    transform:translate(-50%,-50%);
    width:min(560px,92vw);
    text-align:center;
    z-index:5;
  }

  h2{
    margin:0 0 14px;
    color:#fff;
    font-weight:900;
    font-size:22px;
    text-shadow:0 10px 30px rgba(0,0,0,.45);
  }

  .btn-row{
    display:flex;
    justify-content:center;
    gap:18px;
    align-items:center;
  }

  button{
    padding:14px 28px;
    border:none;
    border-radius:999px;
    font-size:18px;
    cursor:pointer;
    user-select:none;
    touch-action:manipulation;
    transition: transform .25s ease, left .25s ease, top .25s ease;
  }

  #yes{
    background:#ff3b7b;
    color:#fff;
    transform:scale(1);
    z-index:9998;
  }

  #no{
    background:#eee;
    color:#111;
    z-index:9999;
  }

  .love-box{
    position:fixed;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width:min(560px,92vw);
    padding:18px 18px;
    border-radius:22px;
    background:rgba(255,255,255,.80);
    backdrop-filter: blur(10px);
    box-shadow:0 18px 45px rgba(0,0,0,.22);
    text-align:center;
    z-index:10;
    display:none;
  }
  .love-box.show{ display:block; }

  .love-text{
    margin:0;
    color:#ff3b7b;
    font-weight:900;
    font-size:20px;
    line-height:1.35;
  }

  .hearts{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:9; }
  .heart{ position:absolute; bottom:-30px; animation: float 2.2s ease forwards; opacity:.95; }
  @keyframes float{
    0%{transform:translateY(0) scale(.8);opacity:0}
    10%{opacity:1}
    100%{transform:translateY(-420px) scale(1.55);opacity:0}
  }
</style>
</head>

<body>
  <div class="overlay"></div>
  <div class="hearts" id="hearts"></div>

  <div class="love-box" id="loveBox">
    <p class="love-text">Ba bi·∫øt m√†aa, ba y√™u Thu Trang nhi·ªÅu l·∫Ømmm ü¶¶</p>
  </div>

  <div class="center" id="centerUI">
    <h2>Thu Trang ∆°i, do you be my valentine? üíåü´ß</h2>
    <div class="btn-row">
      <button id="yes">Yes</button>
      <button id="no">No</button>
    </div>
  </div>

<script>
  const yesBtn = document.getElementById("yes");
  const noBtn  = document.getElementById("no");
  const hearts = document.getElementById("hearts");
  const loveBox = document.getElementById("loveBox");
  const centerUI = document.getElementById("centerUI");

  let noCount = 0;
  let heartTimer = null;
  let finalScale = null;
  let noIsFloating = false;

  function rand(min,max){ return Math.floor(Math.random()*(max-min)+min); }

  // ‚úÖ L·∫•y safe-area (tai th·ªè) + ch·ª´a thanh url tr√™n/d∆∞·ªõi
  function safeInsets(){
    const cs = getComputedStyle(document.documentElement);
    const topSA = parseFloat(cs.getPropertyValue("--sat")) || 0; // fallback
    return {
      top:  Math.max(16, parseFloat(getComputedStyle(document.body).paddingTop) || 0, 24),
      bottom:  Math.max(16, parseFloat(getComputedStyle(document.body).paddingBottom) || 0, 24)
    };
  }

  function getSafePadding(){
    // iOS safe-area env() kh√¥ng ƒë·ªçc ƒë∆∞·ª£c tr·ª±c ti·∫øp b·∫±ng JS ·ªïn ƒë·ªãnh,
    // n√™n m√¨nh ch·ª´a th·ªß c√¥ng th√™m m·ªôt kho·∫£ng ‚Äúƒë·ªß ch·∫Øc‚Äù.
    // Top: tr√°nh status bar + header in-app
    // Bottom: tr√°nh thanh URL Safari
    return { top: 90, bottom: 110, side: 14 };
  }

  function computeFinalScale(){
    const r = yesBtn.getBoundingClientRect();
    const targetW = window.innerWidth * 0.92;
    let s = targetW / r.width;
    s = Math.min(Math.max(s, 1), 12);
    return s;
  }

  // ‚úÖ NO ch·∫°y trong v√πng ‚Äúan to√†n‚Äù, kh√¥ng l·ªçt ra ngo√†i m√†n h√¨nh
  function moveNoAnywhereSafe(){
    const pad = getSafePadding();
    const b = noBtn.getBoundingClientRect();

    const minX = pad.side;
    const maxX = Math.max(minX, window.innerWidth - b.width - pad.side);

    const minY = pad.top;
    const maxY = Math.max(minY, window.innerHeight - b.height - pad.bottom);

    const x = rand(minX, maxX);
    const y = rand(minY, maxY);

    noBtn.style.left = x + "px";
    noBtn.style.top  = y + "px";
  }

  function spawnHeart(){
    const icons = ["üíó","üíñ","‚ù§Ô∏è","ü´ß"];
    const h = document.createElement("div");
    h.className = "heart";
    h.textContent = icons[rand(0, icons.length)];
    h.style.left = rand(0, window.innerWidth) + "px";
    h.style.fontSize = rand(18, 36) + "px";
    h.style.animationDuration = (1.8 + Math.random()*1.1).toFixed(2) + "s";
    hearts.appendChild(h);
    h.addEventListener("animationend", ()=> h.remove());
  }

  function startHeartsForever(){
    if (heartTimer) return;
    heartTimer = setInterval(() => {
      spawnHeart();
      if (Math.random() > 0.45) spawnHeart();
    }, 180);
  }

  // ‚úÖ n·∫øu NO ‚Äúl·ª°‚Äù b·ªã ra ngo√†i (do resize/URL bar), k√©o v·ªÅ gi·ªØa
  function keepNoVisible(){
    if (!noIsFloating) return;
    const r = noBtn.getBoundingClientRect();
    const pad = getSafePadding();
    const out =
      r.right < 0 || r.left > window.innerWidth ||
      r.bottom < pad.top || r.top > window.innerHeight - pad.bottom;

    if (out){
      noBtn.style.left = "50%";
      noBtn.style.top  = "50%";
      noBtn.style.transform = "translate(-50%,-50%)";
      // Sau ƒë√≥ nh·∫£y l·∫°i 1 ph√°t cho ƒë√∫ng h√†nh vi
      setTimeout(() => {
        noBtn.style.transform = "";
        moveNoAnywhereSafe();
      }, 120);
    }
  }

  noBtn.addEventListener("pointerdown",(e)=>{
    e.preventDefault();

    // L·∫ßn ƒë·∫ßu: chuy·ªÉn sang fixed nh∆∞ng gi·ªØ ngay v·ªã tr√≠ ‚Äúnh√¨n th·∫•y‚Äù
    if (!noIsFloating){
      noIsFloating = true;
      noBtn.style.position = "fixed";
      noBtn.style.zIndex = 9999;

      // ƒë·∫∑t n√≥ ƒë√∫ng ch·ªó ƒëang ƒë·ª©ng r·ªìi m·ªõi nh·∫£y (tr√°nh bi·∫øn m·∫•t)
      const rect = noBtn.getBoundingClientRect();
      noBtn.style.left = rect.left + "px";
      noBtn.style.top  = rect.top + "px";
    }

    // nh·∫£y trong v√πng an to√†n
    moveNoAnywhereSafe();

    // YES to d·∫ßn ~15 l·∫ßn
    noCount++;
    if (!finalScale) finalScale = computeFinalScale();
    const t = Math.min(noCount / 15, 1);
    const scale = 1 + t * (finalScale - 1);

    if (t > 0.55){
      yesBtn.style.position = "fixed";
      yesBtn.style.left = "50%";
      yesBtn.style.top  = "62%";
      yesBtn.style.transform = `translate(-50%,-50%) scale(${scale})`;
    } else {
      yesBtn.style.transform = `scale(${scale})`;
    }

    if (t === 1){
      yesBtn.style.position = "fixed";
      yesBtn.style.left = "50%";
      yesBtn.style.top  = "62%";
      yesBtn.style.transform = `translate(-50%,-50%) scale(${finalScale})`;
    }
  });

  yesBtn.addEventListener("click", ()=>{
    document.body.classList.add("yes-bg");
    loveBox.classList.add("show");

    centerUI.style.display = "none";
    noBtn.style.display = "none";
    yesBtn.style.display = "none";

    startHeartsForever();
  });

  // iOS / in-app browser hay thay ƒë·ªïi viewport khi thanh URL co gi√£n
  window.addEventListener("resize", ()=>{
    finalScale = null;
    keepNoVisible();
  });
  window.addEventListener("scroll", ()=> keepNoVisible(), {passive:true});
</script>
</body>
</html>
